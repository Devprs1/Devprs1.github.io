<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Nmc Tiers - PvPTiers Replica</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(71,234,255,0.06), transparent),
                  linear-gradient(135deg,#0f1224 0%, #161824 40%, #1b1630 100%);
      color:#dfefff;
      display:flex;
      flex-direction:column;
      min-height:100vh;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    header{padding:22px 18px 12px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.03)}
    .brand{display:flex;align-items:center;gap:14px;justify-content:center;flex-wrap:wrap}
    .logo{font-weight:900;font-size:1.9rem;color:#8fe9ff;letter-spacing:1px}
    .tagline{color:#a8cfff;font-weight:700;font-size:0.95rem}
    .tabs{margin-top:10px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    .tab{display:flex;gap:10px;align-items:center;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:28px;padding:8px 12px;cursor:pointer;border:1px solid transparent;transition:transform .18s,box-shadow .18s}
    .tab img{width:20px;height:20px;border-radius:4px;object-fit:cover}
    .tab strong{font-size:0.95rem}
    .tab:hover{transform:translateY(-3px)}
    .tab.active{background:linear-gradient(90deg,#2328ff,#47eaff);box-shadow:0 6px 28px rgba(71,234,255,0.14);color:#001028}
    .top-bar{
      display:flex;
      gap:12px;
      justify-content:space-between;
      align-items:center;
      margin:16px 0 10px 0;
      flex-wrap:wrap;
    }
    .search-wrap{
      display:flex;
      align-items:center;
      background:#101524;
      border-radius:999px;
      padding:4px 12px;
      box-shadow:0 2px 14px rgba(35,40,255,0.06);
      border:1px solid #2328ff33;
    }
    .search-wrap input{
      background:transparent;
      border:none;
      outline:none;
      font-size:1rem;
      color:#dfefff;
      margin-left:8px;
      width:150px;
      min-width:80px;
      padding:5px 0;
    }
    .search-icon{
      color:#47eaff;
      font-size:1.18rem;
      opacity:0.8;
      margin-left:2px;
    }
    .sort-wrap{
      display:flex;
      gap:6px;
      align-items:center;
    }
    .sort-select{
      background:#101524;
      color:#dfefff;
      border:1px solid #2328ff33;
      border-radius:18px;
      font-size:0.98rem;
      padding:5px 10px;
      outline:none;
      cursor:pointer;
      font-weight:700;
      margin:0 3px;
    }
    .add-btn{
      background:linear-gradient(90deg, #2328ff 40%, #47eaff 90%);
      color:#fff;
      border:none;
      border-radius:22px;
      padding:7px 17px;
      font-size:0.99rem;
      font-weight:800;
      cursor:pointer;
      box-shadow:0 2px 14px 0 #47eaff28;
      margin-left:8px;
      transition:background .15s, box-shadow .18s, transform .18s;
    }
    .add-btn:hover{
      background:linear-gradient(90deg,#47eaff 0%,#2328ff 90%);
      box-shadow:0 0 20px 0 #47eaffcc;
      transform:scale(1.07);
    }

    main{flex:1;padding:3px 6vw 48px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px;max-width:1200px;margin:0 auto}

    .card{
      position:relative;overflow:hidden;border-radius:14px;padding:16px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent),linear-gradient(135deg, rgba(35,40,255,0.02), rgba(71,234,255,0.02));
      border:1px solid rgba(255,255,255,0.03);
      box-shadow:0 10px 30px rgba(6,10,20,0.6);
      transform-origin:center;
      transition:transform .22s cubic-bezier(.2,.9,.2,1),box-shadow .22s;
      cursor:pointer;
      opacity:0;transform:translateY(18px) scale(.98)
    }
    .card.show{animation:cardIn .55s cubic-bezier(.2,.9,.2,1) forwards}
    @keyframes cardIn{to{opacity:1;transform:translateY(0) scale(1)}}
    .card:hover{transform:translateY(-8px) scale(1.02);box-shadow:0 18px 50px rgba(34,40,255,0.12),0 0 48px rgba(71,234,255,0.06)}
    .top{
      display:flex;gap:10px;align-items:center;
    }
    .rank{
      font-size:1.6rem;font-weight:900;width:48px;min-width:48px;text-align:left;
      background:linear-gradient(90deg,#47eaff,#6b8cff 80%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      filter:drop-shadow(0 4px 12px rgba(71,234,255,0.08));
    }
    .player{flex:1;min-width:0}
    .player .name{font-weight:800;font-size:1.05rem;color:#fff;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;}
    .player .meta{font-size:0.83rem;color:#a8c7ff;margin-top:4px}
    .gm-icon{width:36px;height:36px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);display:flex;align-items:center;justify-content:center;flex-shrink:0;box-shadow:inset 0 -6px 18px rgba(0,0,0,0.35);border:1px solid rgba(255,255,255,0.02)}
    .gm-icon img{width:26px;height:26px;object-fit:contain;border-radius:6px}
    .avatar{width:38px;height:38px;border-radius:6px;object-fit:cover;margin-right:7px;background:#222;box-shadow:0 2px 8px #47eaff22}
    .score-row{display:flex;align-items:center;justify-content:space-between;margin-top:14px;gap:12px}
    .score-wrap{display:flex;flex-direction:column;align-items:flex-start;min-width:90px}
    .score{font-weight:900;font-size:1.2rem;background:linear-gradient(90deg,#47eaff,#2328ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .progress-bar-bg{
      width:100px;height:9px;background:#233; border-radius:6px;margin-top:8px;
      position:relative;overflow:hidden;
    }
    .progress-bar{
      position:absolute;left:0;top:0;height:100%;background:linear-gradient(90deg,#47eaff,#2328ff);border-radius:6px;transition:width .8s cubic-bezier(.2,.9,.2,1)
    }
    .actions{display:flex;gap:8px;margin-left:auto}
    .btn{background:linear-gradient(90deg, rgba(35,40,255,0.18), rgba(71,234,255,0.08));border:1px solid rgba(255,255,255,0.03);color:#dff6ff;padding:7px 10px;border-radius:999px;font-weight:700;font-size:0.86rem;cursor:pointer;transition:transform .16s,box-shadow .16s}
    .btn:hover{transform:translateY(-3px);box-shadow:0 10px 28px rgba(71,234,255,0.08)}
    .accent-strip{position:absolute;inset:auto 0 0 0;height:6px;background:linear-gradient(90deg,#47eaff,#2328ff);opacity:0.14;filter:blur(6px);transition:opacity .2s}
    .card:hover .accent-strip{opacity:0.28}
    .toast{position:fixed;right:18px;bottom:18px;background:linear-gradient(90deg,#0b101a,#0f1724);border:1px solid rgba(255,255,255,0.04);color:#dff6ff;padding:12px 16px;border-radius:12px;box-shadow:0 8px 42px rgba(2,6,23,0.6);z-index:9999;transform:translateY(12px);opacity:0;transition:opacity .22s, transform .22s}
    .toast.show{transform:translateY(0);opacity:1}
    /* Modal Styles */
    .modal-backdrop{
      position:fixed;inset:0;z-index:9998;background:rgba(14,18,38,0.88);backdrop-filter:blur(4px);
      transition:opacity .2s;
      opacity:0;pointer-events:none;
    }
    .modal-backdrop.open{opacity:1;pointer-events:all;}
    .modal{
      position:fixed;z-index:9999;
      left:50%;top:50%;transform:translate(-50%,-50%);
      background:#101525;
      color:#eaf0fa;
      min-width:320px;max-width:98vw;width:400px;
      border-radius:18px;
      box-shadow:0 16px 60px #2328ff88;
      padding:28px 22px 22px 22px;
      display:flex;flex-direction:column;align-items:center;
      opacity:0;pointer-events:none;
      transition:opacity .25s, transform .22s;
    }
    .modal.open{opacity:1;pointer-events:all;}
    .modal .close-btn{
      position:absolute;right:18px;top:14px;
      background:none;border:none;color:#47eaff;font-size:1.32rem;cursor:pointer;
    }
    .modal .modal-avatar{width:84px;height:84px;border-radius:16px;margin-bottom:6px;box-shadow:0 6px 18px #47eaff33;background:#222;}
    .modal h2{margin:5px 0 2px 0;font-size:1.24rem;font-weight:900}
    .modal .meta{color:#a8c7ff;font-size:0.98rem;margin-bottom:10px;}
    .modal .modal-score{
      font-size:1.5rem;font-weight:900;margin-bottom:5px;background:linear-gradient(90deg,#47eaff,#2328ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;
    }
    .modal .progress-bar-bg{width:220px;height:16px;margin-top:8px;}
    .modal .progress-bar{height:100%;}
    .modal .modal-btns{margin-top:16px;display:flex;gap:10px;}
    .modal .modal-label{margin-top:18px;font-weight:700;font-size:1.05rem;color:#a8c7ff;}
    .modal .modal-value{font-size:1.1rem;font-weight:700;}
    /* Add Player Modal */
    .modal .add-form{margin-top:8px;width:100%;display:flex;flex-direction:column;gap:14px;}
    .modal .add-form label{font-size:1rem;font-weight:700;margin-bottom:2px;}
    .modal .add-form input, .modal .add-form select{
      padding:8px 11px;font-size:1rem;background:#14182c;color:#eaf0fa;border:1px solid #2328ff44;border-radius:8px;outline:none;
      font-family:inherit;
    }
    .modal .add-form .add-actions{display:flex;gap:10px;justify-content:flex-end;}
    @media(max-width:700px){
      .grid{gap:14px}
      .rank{font-size:1.2rem;width:38px}
      .gm-icon{width:28px;height:28px}
      .avatar{width:32px;height:32px}
      .modal{width:94vw;min-width:90px;padding:14px 4vw 18px 4vw;}
      .modal .modal-avatar{width:62px;height:62px}
      .modal .progress-bar-bg{width:90vw;max-width:94vw;height:10px}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">Nmc Tiers</div>
      <div class="tagline">Competitive Minecraft PvP Rankings â€” replica</div>
    </div>
    <div class="tabs" id="tabs" aria-label="Gamemodes"></div>
  </header>
  <main>
    <div class="top-bar">
      <form class="search-wrap" id="searchForm" autocomplete="off" onsubmit="return false;">
        <span class="search-icon">&#128269;</span>
        <input type="search" id="searchInput" placeholder="Search player..." aria-label="Search players"/>
      </form>
      <div class="sort-wrap">
        <label for="sortSelect" style="color:#a8cfff;font-size:0.98rem;font-weight:700;">Sort:</label>
        <select id="sortSelect" class="sort-select">
          <option value="rank">Rank</option>
          <option value="score">Score</option>
          <option value="name">Name</option>
        </select>
      </div>
      <button class="add-btn" id="addBtn" type="button">+ Add Player</button>
    </div>
    <div class="grid" id="grid" role="list"></div>
  </main>
  <div id="toast" class="toast" aria-live="polite" role="status" style="display:none"></div>
  <div class="modal-backdrop" id="modalBackdrop"></div>
  <div class="modal" id="modal"></div>
  <script>
    /*** CONFIG ***/
    const DISCORD_WEBHOOK = ""; // <-- Set this to your Discord webhook URL if you want Discord integration

    const GAMEMODES = [
      { id: 'overall', name: 'Overall', icon: 'https://pvptiers.com/icons/tiers/overall.png' },
      { id: 'crystal',  name: 'Crystal',  icon: 'https://pvptiers.com/icons/tiers/crystal.png' },
      { id: 'sword',    name: 'Sword',    icon: 'https://pvptiers.com/icons/tiers/sword.png' },
      { id: 'uhc',      name: 'UHC',      icon: 'https://pvptiers.com/icons/tiers/uhc.png' },
      { id: 'pot',      name: 'Pot',      icon: 'https://pvptiers.com/icons/tiers/pot.png' },
      { id: 'neth_pot', name: 'Neth Pot', icon: 'https://pvptiers.com/icons/tiers/neth_pot.png' },
      { id: 'smp',      name: 'SMP',      icon: 'https://pvptiers.com/icons/tiers/smp.png' },
      { id: 'axe',      name: 'Axe',      icon: 'https://pvptiers.com/icons/tiers/axe.png' },
      { id: 'mace',     name: 'Mace',     icon: 'https://pvptiers.com/icons/tiers/mace.png' }
    ];

    let players = [
      { id: 'p1', name: 'OoogaBoogaPrs', rank: 1, score: 25342, gamemode: 'overall' },
      { id: 'p2', name: 'ShadowNmc',      rank: 2, score: 21400, gamemode: 'crystal' },
      { id: 'p3', name: 'QuickBlade',     rank: 3, score: 19850, gamemode: 'sword' },
      { id: 'p4', name: 'NetherKing',     rank: 4, score: 18700, gamemode: 'neth_pot' },
      { id: 'p5', name: 'PotMaster',      rank: 5, score: 17430, gamemode: 'pot' },
      { id: 'p6', name: 'AxeSmash',       rank: 6, score: 16200, gamemode: 'axe' },
      { id: 'p7', name: 'MaceMage',       rank: 7, score: 15980, gamemode: 'mace' },
      { id: 'p8', name: 'UHC_Warlord',    rank: 8, score: 14999, gamemode: 'uhc' },
      { id: 'p9', name: 'SmpPlayer',      rank: 9, score: 13000, gamemode: 'smp' }
    ];

    let activeGamemode = 'overall';
    let searchQuery = '';
    let sortKey = 'rank';
    const tabsEl = document.getElementById('tabs');
    const gridEl = document.getElementById('grid');
    const toastEl = document.getElementById('toast');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modal = document.getElementById('modal');
    const searchInput = document.getElementById('searchInput');
    const sortSelect = document.getElementById('sortSelect');
    const addBtn = document.getElementById('addBtn');

    /*** Utilities ***/
    function showToast(msg, timeout=3200){
      toastEl.textContent = msg;
      toastEl.style.display='block';
      setTimeout(()=>toastEl.classList.add('show'),20);
      clearTimeout(toastEl._t);
      toastEl._t = setTimeout(()=>{toastEl.classList.remove('show'); setTimeout(()=>toastEl.style.display='none',260)}, timeout);
    }
    function formatNumber(n){return n.toLocaleString()}
    function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }
    function animateCount(el, end, duration = 900){
      const start=0; const startTime=performance.now();
      function step(now){
        const elapsed=now-startTime; const t=Math.min(1, elapsed/duration);
        const value=Math.round(start + (end-start)*easeOutCubic(t));
        el.textContent = formatNumber(value);
        if(t<1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }
    function gmMeta(id){ return GAMEMODES.find(g => g.id===id) || {id,name:id,icon:''}; }
    function normalize(str){return (str||'').toLowerCase();}

    // Minecraft head by player name (crafatar)
    function mcHeadUrl(username){
      return `https://crafatar.com/avatars/${encodeURIComponent(username)}?overlay&size=64`;
    }

    // Max score for progress bar (visible players)
    function getMaxScore(visiblePlayers){
      return visiblePlayers.length ? Math.max(...visiblePlayers.map(p=>p.score)) : 1;
    }

    /*** Modal helpers ***/
    function openModal(html){
      modal.innerHTML = html;
      modalBackdrop.classList.add('open');
      modal.classList.add('open');
      setTimeout(()=>{modalBackdrop.style.opacity=1;modal.style.opacity=1;},10);
    }
    function closeModal(){
      modalBackdrop.classList.remove('open');
      modal.classList.remove('open');
      modalBackdrop.style.opacity=0;modal.style.opacity=0;
    }
    modalBackdrop.addEventListener('click', closeModal);

    /*** Tabs ***/
    function renderTabs(){
      tabsEl.innerHTML='';
      GAMEMODES.forEach(gm=>{
        const btn = document.createElement('button');
        btn.className='tab'+(gm.id===activeGamemode?' active':'');
        btn.setAttribute('data-gm', gm.id);
        btn.innerHTML = `<img src="${gm.icon}" alt="${gm.name}" loading="lazy"/><strong>${gm.name}</strong>`;
        btn.addEventListener('click', ()=>{
          if(activeGamemode===gm.id) return;
          activeGamemode=gm.id;
          renderTabs(); renderGrid();
        });
        tabsEl.appendChild(btn);
      });
    }

    /*** Search/sort logic ***/
    function filterPlayers(){
      let items = players;
      if(activeGamemode!=='overall') items = items.filter(p=>p.gamemode===activeGamemode);
      if(searchQuery){
        const q = normalize(searchQuery);
        items = items.filter(p=>
          normalize(p.name).includes(q) ||
          String(p.rank).includes(q) ||
          (gmMeta(p.gamemode).name && normalize(gmMeta(p.gamemode).name).includes(q))
        );
      }
      if(sortKey==='score') items = items.slice().sort((a,b)=>b.score-a.score);
      else if(sortKey==='name') items = items.slice().sort((a,b)=>normalize(a.name).localeCompare(normalize(b.name)));
      else items = items.slice().sort((a,b)=>a.rank-b.rank);
      return items;
    }

    /*** Card rendering ***/
    function cardHTML(player, delayIndex, maxScore){
      const gm = gmMeta(player.gamemode);
      const wrapper = document.createElement('article');
      wrapper.className='card';
      wrapper.style.animationDelay = `${Math.min(0.5, delayIndex * 0.06)}s`;
      wrapper.innerHTML = `
        <div class="top">
          <img class="avatar" src="${mcHeadUrl(player.name)}" alt="${player.name} Minecraft Head" loading="lazy" onerror="this.style.opacity=0.5"/>
          <div class="rank">#${player.rank}</div>
          <div class="player">
            <div class="name">${player.name}</div>
            <div class="meta">Ranked #${player.rank} â€¢ ${gm.name}</div>
          </div>
          <div class="gm-icon" title="${gm.name}"><img src="${gm.icon}" alt="${gm.name} icon" loading="lazy"/></div>
        </div>
        <div class="score-row">
          <div class="score-wrap">
            <div style="font-size:0.76rem;color:#9ab8ff;margin-bottom:6px">Score</div>
            <div class="score" data-score="${player.score}">0</div>
            <div class="progress-bar-bg">
              <div class="progress-bar" style="width:0%"></div>
            </div>
          </div>
          <div class="actions">
            <button class="btn btn-view" data-id="${player.id}">View</button>
            <button class="btn btn-discord" data-id="${player.id}">Send</button>
          </div>
        </div>
        <div class="accent-strip"></div>
      `;
      // Animate bar on mount
      setTimeout(()=>{
        const bar = wrapper.querySelector('.progress-bar');
        if(bar) bar.style.width = `${100*Math.min(1, player.score/maxScore)}%`;
      }, 60+delayIndex*40);
      return wrapper;
    }

    function renderGrid(){
      const visiblePlayers = filterPlayers();
      const maxScore = getMaxScore(visiblePlayers);
      gridEl.innerHTML='';
      visiblePlayers.forEach((p, idx)=>{
        const node = cardHTML(p, idx, maxScore);
        gridEl.appendChild(node);
        setTimeout(()=>{
          node.classList.add('show');
          const scoreEl = node.querySelector('.score');
          animateCount(scoreEl, p.score, 900 + Math.min(500, idx*60));
          node.querySelector('.btn-view').addEventListener('click', (e)=>{ e.stopPropagation(); openProfileModal(p,maxScore); });
          node.querySelector('.btn-discord').addEventListener('click', (e)=>{ e.stopPropagation(); sendToDiscord(p); });
          node.addEventListener('click', ()=> openProfileModal(p,maxScore));
        }, 40 + idx*40);
      });
      if(visiblePlayers.length===0){
        const empty = document.createElement('div');
        empty.style.textAlign='center'; empty.style.padding='28px'; empty.style.color='#9fbfff';
        empty.innerHTML = `<strong>No players for ${gmMeta(activeGamemode).name}, or no search results.</strong>`;
        gridEl.appendChild(empty);
      }
    }

    /*** Modal: Profile ***/
    function openProfileModal(player,maxScore){
      const gm = gmMeta(player.gamemode);
      openModal(`
        <button class="close-btn" onclick="document.getElementById('modalBackdrop').click()">&times;</button>
        <img class="modal-avatar" src="${mcHeadUrl(player.name)}" alt="${player.name} Minecraft Head" loading="lazy" onerror="this.style.opacity=0.5"/>
        <h2>${player.name}</h2>
        <div class="meta">Gamemode: <b>${gm.name}</b></div>
        <div class="modal-score">${formatNumber(player.score)}</div>
        <div class="progress-bar-bg">
          <div class="progress-bar" style="width:${100*Math.min(1,player.score/maxScore)}%"></div>
        </div>
        <div class="modal-label">Rank</div>
        <div class="modal-value">#${player.rank}</div>
        <div class="modal-btns">
          <button class="btn" onclick="window.NmcTiers.sendToDiscord(window.NmcTiers._modalPlayer)">Send to Discord</button>
        </div>
      `);
      window.NmcTiers._modalPlayer = player;
    }

    /*** Modal: Add Player ***/
    function openAddPlayerModal(){
      openModal(`
        <button class="close-btn" onclick="document.getElementById('modalBackdrop').click()">&times;</button>
        <h2>Add Player</h2>
        <form class="add-form" id="addPlayerForm" autocomplete="off">
          <label>Name <input type="text" name="name" required minlength="3" maxlength="16" autocomplete="off" /></label>
          <label>Score <input type="number" name="score" min="0" required /></label>
          <label>Gamemode
            <select name="gamemode" required>
              ${GAMEMODES.map(gm=>`<option value="${gm.id}">${gm.name}</option>`).join('')}
            </select>
          </label>
          <div class="add-actions">
            <button type="submit" class="btn">Add</button>
            <button type="button" class="btn" onclick="document.getElementById('modalBackdrop').click()">Cancel</button>
          </div>
        </form>
      `);
      const form = document.getElementById('addPlayerForm');
      form.onsubmit = function(e){
        e.preventDefault();
        const fd = new FormData(form);
        const name = fd.get('name').trim();
        const score = Number(fd.get('score'));
        const gamemode = fd.get('gamemode');
        if(!name||!gamemode||isNaN(score)){showToast("Invalid input");return;}
        addPlayer({
          id:"p"+(Date.now()),
          name,score,rank:players.length+1,gamemode
        });
        showToast("Player added!");
        sendToDiscord(players[players.length-1],"added");
        closeModal();
      };
    }

    /*** Discord Webhook ***/
    async function sendToDiscord(player,action="update"){
      if(!DISCORD_WEBHOOK){showToast('Discord webhook not set. Configure DISCORD_WEBHOOK in the HTML.');return;}
      const gm = gmMeta(player.gamemode);
      const content = action==="added"
        ? `New player added to Nmc Tiers:\n**${player.name}** | Gamemode: **${gm.name}** | Score: **${player.score}** | Rank: **${player.rank}**`
        : `Player update from Nmc Tiers:\nName: **${player.name}**\nRank: **#${player.rank}**\nScore: **${player.score.toLocaleString()}**\nGamemode: **${gm.name}**`;
      const payload = {
        content: content,
        embeds: [
          {
            title: `${player.name} â€” Rank #${player.rank}`,
            description: `Gamemode: **${gm.name}**\nScore: **${player.score.toLocaleString()}**`,
            color: 3447003,
            thumbnail: { url: mcHeadUrl(player.name) },
            footer: { text: 'Nmc Tiers' },
            timestamp: new Date().toISOString()
          }
        ]
      };
      try{
        const res = await fetch(DISCORD_WEBHOOK, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if(!res.ok){
          const txt = await res.text().catch(()=>res.statusText);
          showToast('Webhook error: '+(txt||res.status));
        }else{
          showToast('Sent to Discord âœ…');
        }
      }catch(err){
        showToast('Failed to send. See console.');
        console.error('sendToDiscord',err);
      }
    }

    /*** Add Player ***/
    function addPlayer(player){
      // Set rank to next available
      player.rank = players.length+1;
      players.push(player);
      renderGrid();
    }

    /*** Event handlers ***/
    searchInput.addEventListener('input', ()=>{
      searchQuery = searchInput.value;
      renderGrid();
    });
    sortSelect.addEventListener('change', ()=>{
      sortKey = sortSelect.value;
      renderGrid();
    });
    addBtn.addEventListener('click', openAddPlayerModal);

    /*** Startup ***/
    (function init(){
      renderTabs();
      renderGrid();
      window.NmcTiers = {players, GAMEMODES, renderGrid, renderTabs, sendToDiscord, addPlayer};
      window.NmcTiers.sendToDiscord = sendToDiscord;
      // Modal close by esc
      window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });
    })();
  </script>
</body>
</html>
