<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NmcTiers - Overall Ranking</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --main-bg-color: #050505;
            --header-bg-color: #080808;
            --card-bg-color: #101010;
            --border-color-dark: #1a1a1a;
            --border-color-light: #333;
            --text-light: #ffffff;
            --text-dark: #bbbbbb;
            --accent-gold: #ffb800;
            --accent-gold-rgb: 255, 184, 0;
            --accent-red-glow: #ff4500;
            --accent-red-glow-rgb: 255, 69, 0;
            --accent-purple: #8854c4;
            --hover-dark: #181818;
            --focus-glow: 0 0 40px rgba(var(--accent-gold-rgb), 1);
            --tier-combatmaster: var(--accent-purple);
            --tier-nr: #d64a4a;
            --tier-eu: #4a8ad6;
        }

        /* ... (keep existing particle and styling CSS) ... */
    </style>
</head>
<body>
    <div id="particle-container">
        <div class="particle particle1"></div>
        <div class="particle particle2"></div>
        <div class="particle particle3"></div>
        <div class="particle particle4"></div>
    </div>

    <div class="page-wrapper">
        <div class="top-header">
            <div class="logo">
                <img src="https://i.imgur.com/example_logo.png" alt="PvPTiers Logo">
            </div>
            <div class="server-ip">
                SERVER IP: <span>pvptiers.com</span>
            </div>
        </div>

        <nav class="main-nav-bar">
            <ul>
                <li><a href="index.html" class="active"><img src="https://pvptiers.com/icons/tiers/overall.png" alt="Home Icon">HOME</a></li>
                <li><a href="community.html"><img src="https://pvptiers.com/icons/tiers/smp.png" alt="Community Icon">COMMUNITY</a></li>
            </ul>
        </nav>

        <div class="container">
            <h1 class="rankings-title">Rankings</h1>

            <div class="gamemode-nav">
                <a href="index.html" class="active">
                    <img src="https://pvptiers.com/icons/tiers/overall.png" alt="Overall Icon">
                    OVERALL
                </a>
                <a href="crystal.html">
                    <img src="https://pvptiers.com/icons/tiers/crystal.png" alt="Crystal Icon">
                    CRYSTAL
                </a>
                <a href="sumo.html">
                    <img src="https://pvptiers.com/icons/tiers/sword.png" alt="Sumo Icon">
                    SWORD
                </a>
                <a href="uhc.html">
                    <img src="https://pvptiers.com/icons/tiers/uhc.png" alt="UHC Icon">
                    UHC
                </a>
                <a href="soup.html">
                    <img src="https://pvptiers.com/icons/tiers/pot.png" alt="Pot Icon">
                    POT
                </a>
                <a href="neth_pot.html">
                    <img src="https://pvptiers.com/icons/tiers/neth_pot.png" alt="Nether Pot Icon">
                    NETHERITE POT
                </a>
                <a href="smp.html">
                    <img src="https://pvptiers.com/icons/tiers/smp.png" alt="SMP Icon">
                    SMP
                </a>
                <a href="axe.html">
                    <img src="https://pvptiers.com/icons/tiers/axe.png" alt="Axe Icon">
                    AXE
                </a>
                <a href="mace.html">
                    <img src="https://pvptiers.com/icons/tiers/mace.png" alt="Mace Icon">
                    MACE
                </a>
            </div>

            <div class="main-content-grid">
                <div class="leaderboard-section">
                    <div class="leaderboard-table-header player-row">
                        <div class="player-rank-col">#</div>
                        <div class="player-info-col">PLAYER</div>
                        <div class="player-region-col region-th">REGION</div>
                        <div class="player-points-col">POINTS</div>
                        <div class="player-items-col"></div>
                    </div>
                    <div id="leaderboardBody"></div>
                </div>

                <div class="right-sidebar">
                    <div class="info-card">
                        <a href="#" class="info-button">Info</a>
                    </div>
                    <div class="search-card">
                        <div class="search-input-wrapper">
                            <input type="text" id="playerSearch" placeholder="SEARCH...">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="playerProfileModalOverlay" class="profile-modal-overlay">
        <div class="profile-modal">
            <div class="profile-modal-header">
                <h2 id="modalPlayerName">Player Name</h2>
                <button class="profile-modal-close-btn" onclick="closePlayerProfileModal()">&#x2715;</button>
            </div>
            <div class="modal-player-overview">
                <div class="modal-player-meta">
                    <span id="modalPlayerRegion" class="region-badge region-na">NA</span>
                    <span id="modalPlayerTier" class="player-tier-badge">COMBATMASTER</span>
                    <div class="overall-points-display">
                        <img src="https://pvptiers.com/icons/tiers/overall.png" alt="Overall Icon">
                        OVERALL <span id="modalPlayerPoints">284</span> Points
                    </div>
                </div>
                <img id="modalPlayerSkin" src="https://mc-heads.net/avatar/Marlowww/100" alt="Player Skin" class="modal-player-skin">
                <img id="modalPlayerRankBadge" src="https://i.imgur.com/yU4eYwP.png" alt="Rank Badge" class="modal-rank-badge">
                <a href="#" class="namemc-button" target="_blank" id="namemcLink">NameMC</a>
                <h3 class="modal-section-title">Tiers</h3>
                <div class="modal-tiers-grid" id="modalPlayerTiers"></div>
                <h3 class="modal-section-title">Retired</h3>
                <div class="modal-retired-grid" id="modalPlayerRetiredItems"></div>
            </div>
        </div>
    </div>

    <script>
        const allGamemodes = [
            { id: 'crystal', name: 'Crystal', iconUrl: 'https://pvptiers.com/icons/tiers/crystal.png' },
            { id: 'sword', name: 'Sword', iconUrl: 'https://pvptiers.com/icons/tiers/sword.png' },
            { id: 'uhc', name: 'UHC', iconUrl: 'https://pvptiers.com/icons/tiers/uhc.png' },
            { id: 'pot', name: 'Pot', iconUrl: 'https://pvptiers.com/icons/tiers/pot.png' },
            { id: 'neth_pot', name: 'Neth Pot', iconUrl: 'https://pvptiers.com/icons/tiers/neth_pot.png' },
            { id: 'smp', name: 'SMP', iconUrl: 'https://pvptiers.com/icons/tiers/smp.png' },
            { id: 'axe', name: 'Axe', iconUrl: 'https://pvptiers.com/icons/tiers/axe.png' },
            { id: 'mace', name: 'Mace', iconUrl: 'https://pvptiers.com/icons/tiers/mace.png' },
            { id: 'question', name: 'Question', iconUrl: 'https://pvptiers.com/icons/gamemodes/question.png' }
        ];

        function getGamemodeIconUrl(id) {
            const gamemode = allGamemodes.find(gm => gm.id === id);
            return gamemode ? gamemode.iconUrl : allGamemodes.find(gm => gm.id === 'question').iconUrl;
        }

        async function fetchLeaderboard() {
            try {
                const response = await fetch('http://localhost:5000/api/leaderboard');
                const leaderboard = await response.json();
                const leaderboardBody = document.getElementById('leaderboardBody');
                leaderboardBody.innerHTML = '';
                leaderboard.forEach((player, index) => {
                    const row = document.createElement('div');
                    row.className = 'player-row';
                    row.innerHTML = `
                        <div class="player-rank-col"><span class="rank-number">${index + 1}</span></div>
                        <div class="player-info-col">
                            <img src="https://mc-heads.net/avatar/${player.name}/32" alt="${player.name} Skin" class="player-avatar">
                            <div class="player-details">
                                <a href="#" data-player-name="${player.name}" onclick="openPlayerProfileModal(event, '${player.name}')">${player.name}</a>
                                <span class="player-tier-points-label">
                                    <span class="player-tier-badge">COMBATMASTER</span>
                                    <span>${player.points} Points</span>
                                </span>
                            </div>
                        </div>
                        <div class="player-region-col">
                            <span class="region-badge region-${player.region.toLowerCase()}">${player.region}</span>
                            <span class="region-info-icon" title="Region Info">â“˜</span>
                        </div>
                        <div class="player-points-col">${player.points}</div>
                        <div class="player-items-col">
                            ${player.unlockedTiers.map(t => `
                                <div class="item-slot">
                                    <div class="item-icon-hex" data-item-type="${t.gamemode}" style="background-image: url('${getGamemodeIconUrl(t.gamemode)}');"></div>
                                    <div class="item-label-box">${t.tier}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    leaderboardBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error fetching leaderboard:', error);
                document.getElementById('leaderboardBody').innerHTML = '<div class="player-row">Error loading leaderboard.</div>';
            }
        }

        async function populateModal(playerName) {
            try {
                const response = await fetch(`http://localhost:5000/api/leaderboard`);
                const leaderboard = await response.json();
                const playerData = leaderboard.find(p => p.name.toLowerCase() === playerName.toLowerCase());

                if (!playerData) {
                    alert(`Player '${playerName}' not found.`);
                    return;
                }

                document.getElementById('modalPlayerName').textContent = playerData.name;
                const modalPlayerRegion = document.getElementById('modalPlayerRegion');
                modalPlayerRegion.textContent = playerData.region;
                modalPlayerRegion.className = `region-badge region-${playerData.region.toLowerCase()}`;
                document.getElementById('modalPlayerTier').textContent = 'COMBATMASTER'; // Placeholder, adjust if tiers vary
                document.getElementById('modalPlayerPoints').textContent = playerData.points;
                document.getElementById('modalPlayerSkin').src = `https://mc-heads.net/avatar/${playerName}/100`;
                document.getElementById('modalPlayerRankBadge').src = 'https://i.imgur.com/yU4eYwP.png'; // Default badge
                document.getElementById('namemcLink').href = `https://namemc.com/profile/${playerData.name}`;

                const modalPlayerTiersContainer = document.getElementById('modalPlayerTiers');
                modalPlayerTiersContainer.innerHTML = '';
                allGamemodes.slice(0, 8).forEach(gamemode => {
                    const isUnlocked = playerData.unlockedTiers.some(t => t.gamemode === gamemode.id);
                    modalPlayerTiersContainer.innerHTML += `
                        <div class="modal-tier-item">
                            <div class="modal-tier-icon ${isUnlocked ? '' : 'locked'}"
                                 style="background-image: url('${getGamemodeIconUrl(gamemode.id)}');">
                            </div>
                        </div>
                    `;
                });

                const modalPlayerRetiredItemsContainer = document.getElementById('modalPlayerRetiredItems');
                modalPlayerRetiredItemsContainer.innerHTML = ''; // No retired items in current data
            } catch (error) {
                console.error('Error populating modal:', error);
            }
        }

        function openPlayerProfileModal(event, playerName) {
            if (event) event.preventDefault();
            populateModal(playerName);
            document.getElementById('playerProfileModalOverlay').classList.add('active');
        }

        function closePlayerProfileModal() {
            document.getElementById('playerProfileModalOverlay').classList.remove('active');
        }

        function searchPlayer() {
            const playerSearchInput = document.getElementById('playerSearch');
            if (!playerSearchInput) {
                console.error("Error: 'playerSearch' element not found.");
                return;
            }
            const searchTerm = playerSearchInput.value.trim();
            if (searchTerm) {
                openPlayerProfileModal(null, searchTerm);
            } else {
                alert('Please enter a player name to search.');
            }
        }

        document.getElementById('playerSearch').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                searchPlayer();
            }
        });

        // Initial load and periodic refresh
        fetchLeaderboard();
        setInterval(fetchLeaderboard, 30000); // Refresh every 30 seconds
    </script>
</body>
</html>
